<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Product">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>Numeric Computation | Dart: Structured web apps</title>
  <meta property="twitter:account_id" content="376585411" />
  <meta itemprop="name" content="Numeric Computation | Dart: Structured web apps">
  
  <meta itemprop="image" content="https://www.dartlang.org/imgs/dart-logo-wordmark-1200w.png">
  
  <meta itemprop="description" content="How you store and use numbers can have a big impact on your app's performance. This article focuses on the Dart VM, with additional tips for apps that are compiled to JavaScript.">



<!-- making pagespeed insights happy -->
<style>
@font-face {
  font-family: 'Montserrat';
  font-style: normal;
  font-weight: 400;
  src: url(https://themes.googleusercontent.com/static/fonts/montserrat/v4/zhcz-_WihjSQC0oHJ9TCYL3hpw3pgy2gAi-Ip7WPMi0.woff) format('woff');
}
@font-face {
  font-family: 'Montserrat';
  font-style: normal;
  font-weight: 700;
  src: url(https://themes.googleusercontent.com/static/fonts/montserrat/v4/IQHow_FEYlDC4Gzy_m8fcnbFhgvWbfSbdVg11QabG8w.woff) format('woff');
}
@font-face {
  font-family: 'Roboto';
  font-style: normal;
  font-weight: 300;
  src: url(https://themes.googleusercontent.com/static/fonts/roboto/v10/Hgo13k-tfSpn0qi1SFdUfbO3LdcAZYWl9Si6vvxL-qU.woff) format('woff');
}
@font-face {
  font-family: 'Roboto';
  font-style: normal;
  font-weight: 400;
  src: url(https://themes.googleusercontent.com/static/fonts/roboto/v10/CrYjSnGjrRCn0pd9VQsnFOvvDin1pK8aKteLpeZ5c0A.woff) format('woff');
}
</style>

<link rel='stylesheet' type='text/css' href='http://takyam-git.github.io/www.dartlang.org/bundles/96e4b278be2e9b94cffcad9b0b04384c.css' />


  <link rel="author" href="http://takyam-git.github.io/www.dartlang.org/authors/john-mccutchan.html">
  

  <link rel="alternate" type="application/atom+xml" href="http://news.dartlang.org/feeds/posts/default" title="Atom feed">
  <link href="https://plus.google.com/109866369054280216564" rel="publisher">

  <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
  <![endif]-->

  <script>

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-49880327-3', 'dartlang.org');
ga('create', 'UA-26406144-4',
    {'cookieDomain': 'dartlang.org',
     'siteSpeedSampleRate': 50,
     'name': 'dartlangTracker'});

ga('send', 'pageview');
ga('dartlangTracker.send', 'pageview');

</script>


  <script async="" defer="" src="http://takyam-git.github.io/www.dartlang.org/survey.g.doubleclick.net/async_survey?site=apno2k33xucna4srya26u4i2ri"></script>

</head>
<body onload="prettyPrint()" data-spy="scroll" data-target=".bs-sidebar">

    <div class="navbar navbar-fixed-top navbar-inverse" role="navigation">
      <div class="dart-developer-summit-reg" style="text-align:center;background-color: hsl(172,67%,80%);">
        <a href="http://takyam-git.github.io/www.dartlang.org/events/2015/summit/">Watch sessions from the first Dart Developer Summit</a>
      </div>
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://takyam-git.github.io/www.dartlang.org/"><i class="sprite-icon-dart-logo"></i></a>
        </div>

        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
           <li class="dropdown">
              <a href="#" class="dropdown=toggle" data-toggle="dropdown">
                Get Started <span class="caret"></span>
              </a>
              <ul class="dropdown-menu">

                <i class="sprite-icon-dd-tip"></i>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/codelabs/darrrt/">Learn Dart in Minutes</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/downloads/">Download Dart</a></li>
              </ul>
            </li>

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    Fundamentals <span class="caret"></span>
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/dart-up-and-running/ch02.html">Language Tour</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/dart-up-and-running/ch03.html">Library Tour</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/">Programmer's Guide</a></li>

                <li class="divider"></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/tools/">Dart Tools</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/tools/pub/">Pub Package and Asset Manager</a></li>

                <li class="divider"></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/tutorials/get-started/">Tutorial: Get Started</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/tutorials/shared-pkgs/">Tutorial: Packages</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/tutorials/futures/">Tutorial: Async</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    Browser<span class="caret"></span>
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/polymer/">Polymer</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/codelabs/polymer/">Polymer Code Lab</a></li>
                <li class="divider"></li>
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/tutorials/connect-dart-html/">Tutorial: HTML</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/tutorials/polymer-intro/">Tutorial: Polymer</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/tutorials/fetchdata/">Tutorial: Forms & Data</a></li>
                <li class="divider"></li>
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/tools/editor/mobile.html">Mobile</a></li>

                <li class="divider"></li>
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/googleapis/">Google APIs Client Libraries</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    Server <span class="caret"></span>
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/tutorials/cmdline/">Tutorial: Basic Command-Line Apps</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/tutorials/httpserver/">Tutorial: HTTP Servers and Clients</a></li>

                <li class="divider"></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/server/google-cloud-platform/">Deploying Your Server Application</a></li>
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/googleapis/">Using Google APIs from Your Server</a></li>

                <li class="divider"></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/serverguide.html">Additional Resources</a></li>
              </ul>
            </li>

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    More <span class="caret"></span>
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>

                <li><a href="http://takyam-git.github.io/www.dartlang.org/samples/">Code Samples</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/synonyms/">Synonyms with Other Languages</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/dart-by-example/">Dart by Example</a></li>

                <li class="divider"></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/articles/">Articles</a></li>
                <li><a href="http://api.dartlang.org">API Reference</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/spec/">Language Specification</a></li>

                <li class="divider"></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/community/who-uses-dart.html">Who Uses Dart</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/support/faq.html">FAQ</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/logos/">Logos and Colors</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/books/">Books</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/performance/">Performance</a></li>

                <li class="divider"></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/slides/">Presentations</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/dart-tips/">Dart Tips Videos</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/support/">Support</a></li>
              </ul>
            </li>
          </ul>

          <ul class="nav navbar-nav navbar-right">
            <li>
              <form class="navbar-search" action="/search.html" id="cse-search-box">
                <input type="hidden" name="cx" value="011220921317074318178:i4mscbaxtru">
                <input type="hidden" name="ie" value="UTF-8">
                <input type="hidden" name="hl" value="en">
                <input type="search" name="q" class="search-query placeholder-position-fix form-control" id="q" autocomplete="off" placeholder="Search">
              </form>
            </li>
            <li><a href="https://twitter.com/dart_lang" class="btn"><i class="sprite-icon-social-twitter"></i></a></li>
            <li><a href="https://plus.google.com/+dartlang/posts" class="btn"><i class="sprite-icon-social-gplus"></i></a></li>
          </ul>
        </div><!-- /.nav-collapse -->

      </div><!-- /.container -->
    </div><!-- /.navbar -->


<div class="container-page">
  <div class="container">
  	<div class="container sub-page">
      <div class="row">
        <article class="has-permalinks"><div class="col-md-4">
  <div class="bs-sidebar" data-spy="affix" data-offset-bottom="350" role="complementary">

<ol class="toc nav bs-sidenav" id="markdown-toc">
  <li><a href="#overview">Overview</a>    <ol>
      <li><a href="#integers">Integers</a></li>
      <li><a href="#floating-point-numbers">Floating-point numbers</a></li>
      <li><a href="#boxed-and-unboxed-numbers">Boxed and unboxed numbers</a></li>
      <li><a href="#lists-of-numbers">Lists of numbers</a>        <ol>
          <li><a href="#object-lists">Object lists</a></li>
          <li><a href="#typed-lists">Typed lists</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#pulling-back-the-curtains">Pulling back the curtains</a>    <ol>
      <li><a href="#integers-1">Integers</a>        <ol>
          <li><a href="#smis-and-mints">Smis and mints</a></li>
          <li><a href="#optimally-shifting-to-the-left">Optimally shifting to the left</a></li>
          <li><a href="#lists-of-integers">Lists of integers</a></li>
          <li><a href="#bigints">Bigints</a></li>
        </ol>
      </li>
      <li><a href="#doubles">Doubles</a>        <ol>
          <li><a href="#lists-of-doubles">Lists of doubles</a></li>
        </ol>
      </li>
      <li><a href="#boxing">Boxing</a></li>
      <li><a href="#lists">Lists</a>        <ol>
          <li><a href="#object-lists-instances-of-list">Object lists (instances of List)</a></li>
          <li><a href="#typed-lists-1">Typed lists</a></li>
        </ol>
      </li>
    </ol>
  </li>
  <li><a href="#considerations-when-dart-is-compiled-to-javascript">Considerations when Dart is compiled to JavaScript</a>    <ol>
      <li><a href="#integer-precision">Integer precision</a></li>
      <li><a href="#typed-lists-2">Typed lists</a></li>
    </ol>
  </li>
</ol>

  </div>
</div>
<div class="col-md-8">
  <p><!-- Start of content -->
</p>

  <div>
    <ol class="breadcrumb">

  <li><a href="http://takyam-git.github.io/www.dartlang.org/articles/">
  Articles</a></li>


  <li class="active">Numeric Computation</li>
</ol>
  </div>

  <h1 id="numeric-computation">Numeric Computation</h1>

  <p><em>Written by John Mccutchan <br />
<time pubdate="" date="2013-05-21">May 2013</time>
</em></p>

  <p>Performance matters to everyone.
It directly impacts your bottom line, conversion rates, and user satisfaction.
Just following a few simple rules can give you 50-100% speed improvements.</p>

  <p>Follow the guidelines in this article
to get the most performance from the Dart VM in numerical applications.
You’ll learn about the four different number representations,
how integer and floating-point numerical computation occurs,
and how to pick the best container for your data.</p>

  <p>This article focuses on the Dart VM.
If your primary compile target is JavaScript, see the section
<a href="#considerations-when-dart-is-compiled-to-javascript">Considerations when Dart is compiled to JavaScript</a>.</p>

  <aside class="alert alert-info">
    <p><strong>Note:</strong>
This article does not cover the SIMD types available in Dart,
which enable operating on four floating-point numbers in parallel.
To learn more, read
<a href="http://takyam-git.github.io/www.dartlang.org/articles/simd/">Using SIMD in Dart</a>.</p>
  </aside>

  <h2 id="overview">Overview</h2>

  <p>The Dart language has two numeric types: int and double.
The former is an arbitrary-precision signed integer,
and the latter is the IEEE-754 double-precision floating-point number.
Examples:</p>

  <pre><code>int speed = 3232943523452345329384234242323523;
int hitPoints = 21;
double position = 32.43432;
double hp = hitPoints.toDouble();
</code></pre>

  <h3 id="integers">Integers</h3>

  <p>While the language specifies an arbitrarily sized integer,
for performance reasons the VM has
three different internal integer representations:
<strong>smi</strong> (rhymes with <em>pie</em>), <strong>mint</strong>, and <strong>bigint</strong>.
Each representation is used to hold different ranges of integer numbers
(see the table).
The VM automatically switches between these representations behind the scenes
as numbers grow and shrink in range.</p>

  <table class="table table-bordered">
  <tr>
    <th> Internal representation </th>
    <td> smi (<b>sm</b>all <b>i</b>nteger) </td>
    <td> mint (<b>m</b>edium <b>int</b>eger) </td>
    <td> bigint </td>
  </tr>
  <tr>
    <th> Minimum value </th>
    <td> -2<sup>30</sup> (on a 32-bit machine)
         <br />
         -2<sup>62</sup> (on a 64-bit machine)</td>
    <td> -2<sup>63</sup> </td>
    <td> Limited by RAM </td>
  </tr>
  <tr>
    <th> Maximum value </th>
    <td> 2<sup>30</sup> - 1 (on a 32-bit machine)
         <br />
         2<sup>62</sup> - 1 (on a 64-bit machine)</td>
    <td> 2<sup>63</sup> - 1 </td>
    <td> Limited by RAM </td>
  </tr>
</table>

  <p>Here is an example of how a single integer value in the VM
graduates from smi to mint to bigint:</p>

  <pre><code>main() {
  int hitPoints = 21; // starts as a smi
  print(hitPoints);  // 21
  hitPoints += potionOfSuperHealth.points; // becomes a mint
  print(hitPoints); // 2133232342342423
  hitPoints += spellOfNearlyInvinciblity.points; // becomes a bigint
  print(hitPoints);  // 99999999999999999999999999999999999999999
}
</code></pre>

  <h3 id="floating-point-numbers">Floating-point numbers</h3>

  <p>The VM has a single representation for floating-point numbers, the
<a href="http://en.wikipedia.org/wiki/Double_precision_floating-point_format">IEEE-754 double-precision floating-point number</a>.</p>

  <h3 id="boxed-and-unboxed-numbers">Boxed and unboxed numbers</h3>

  <p>In Dart, everything is an Object, even numbers.
If you come from a C/C++ background,
this might surprise you.
The result of any arithmetic or bitwise operation
results in a <em>new</em> number object.
Allocating a new object to store
the result of a numeric operation is inefficient,
and for that reason,
the VM employs an optimization technique called <em>unboxing</em>.
Unboxed numbers sit inside CPU registers.
The results of all numeric and bitwise operations on unboxed numbers
are also held in CPU registers,
avoiding most of the overhead of numbers represented as objects.</p>

  <p>Presently the VM supports unboxed double and mint.
The VM employs a trick called tagging so that
it can box and unbox smi values without
allocating memory or loading the value from a object.
More on this later.</p>

  <h3 id="lists-of-numbers">Lists of numbers</h3>

  <p>Dart has two ways to store lists of numeric data:
<em>object lists</em> and <em>typed lists</em>.</p>

  <h4 id="object-lists">Object lists</h4>

  <p>A List stores a list of objects.
Examples include:</p>

  <pre><code>var a = [ 1.0, 2.0, 3.0 ];
var b = new List(3); // Create a new list with a fixed length of 3.
b[0] = 5;
b[1] = 99;
b[2] = 34;
</code></pre>

  <p>The list <code>b</code> is an object list,
meaning it can store any object—for example, a String object or null.
This means that each entry in a List is as wide as the CPU’s pointer type.</p>

  <h4 id="typed-lists">Typed lists</h4>

  <p>Dart offers typed lists that store only numbers.
These lists are available in the
<a href="http://api.dartlang.org/dart_typed_data.html">dart:typed_data library</a>.
Typed lists can store only numbers
and cannot hold regular objects or have a null entry.
The dart:typed_data library has a distinct list for each common integer size,
as well as for 32-bit and 64-bit floating-point numbers.
When working with numbers that are smaller than the pointer width,
these lists can have considerable memory savings.
Some examples:</p>

  <pre><code>var a = new Float64List(3);
a[0] = 1.0;
a[1] = 2.0;
a[2] = 3.0;
var b = new Int8List(3);
b[0] = 5;
b[1] = 99;
b[2] = 34;
</code></pre>

  <p>In both the object list and typed list examples,
the lists named <code>a</code> are holding the same values.
Same for the lists named <code>b</code>.
What’s different is how the values are stored in memory
and how they are accessed.
More on this later.</p>

  <h2 id="pulling-back-the-curtains">Pulling back the curtains</h2>

  <p>The deep dive begins.
This section covers the above concepts in more detail
and provides actionable tips.</p>

  <h3 id="integers-1">Integers</h3>

  <p>The Dart VM has multiple internal representations of integer values.
The following sections explain each one
and how to efficiently perform left shifts.</p>

  <h4 id="smis-and-mints">Smis and mints</h4>

  <p>Remember that the VM has three different integer representations,
switching between them automatically depending on the size of an integer.
This section focuses on smi and mint.</p>

  <p>The first representation, smi,
is the same size as a pointer on your platform, minus 1 bit.
On a 32-bit machine, a smi holds a 31-bit signed integer.
On a 64-bit machine, a smi holds a 63-bit signed integer.
A smi doesn’t require a memory allocation to be created
and is stored directly in a field.
The VM can do this by storing twice the numeric value,
guaranteeing the low bit being 0.
For all other objects
(including boxed doubles, mints, and bigints),
the low bit will be 1.
The VM uses this low bit to distinguish between smis and all other objects.</p>

  <p>Because the stored smi is twice the numeric value,
the value must be right shifted by 1 before operated on;
this is called <em>untagging</em>.
Conversely, after being operated on the value must be added with itself
(equivalent of a multiplication by 2);
this is called <em>tagging</em>.
Despite these extra operations, a smi is very efficient
because it never requires a memory allocation
and all accesses are direct, avoiding dependent loads.
Note that many common operations—for example,
addition—do not require the smi to be untagged.</p>

  <p>Consider an object called <code>entity</code>, defined as follows:</p>

  <pre><code>class Entity {
  Entity() {
    scale = 2;
    x = 3;
    y = 0x40000000;
  }
  int scale;
  int x;
  int y;
}

Entity entity = new Entity();
</code></pre>

  <p>After the above code executes,
in memory on a 32-bit machine the <code>entity</code> object looks like this:</p>

  <p><img src="images/1.png" alt="x and scale are smis and thus stored directly; y is 2^30, so it requires a pointer to memory" /></p>

  <p>Now consider this Dart code:</p>

  <pre><code>entity.x = entity.x * entity.scale;
</code></pre>

  <p>It’s converted into the VM instructions shown in the following figure.
Each VM instruction can return a value
shown as v1, v2, and so on.</p>

  <p><img src="images/2.png" alt="3 values are needed (for x, scale, and the result)" /></p>

  <p>After that code executes, in memory the <code>entity</code> object looks like this:</p>

  <p><img src="images/3.png" alt="Same memory illustration as before, except the value of x is now 24" /></p>

  <p>Now consider the second representation, mint,
which holds a 64-bit signed integer.
When stored, a mint <em>does</em> require a memory allocation.
The field a mint is stored into holds the address of the mint instance.
When loading a mint value,
the CPU must first load the address where the mint is stored
before loading the actual value.</p>

  <p>The following Dart code is converted into the VM instructions shown below.</p>

  <pre><code>entity.y = entity.y + entity.x;
</code></pre>

  <p><img src="images/4.png" alt="6 values are needed (for y, x, unboxed y, unboxed x, the result, and the boxed result" /></p>

  <p>After that code executes, in memory the <code>entity</code> object looks like this:</p>

  <p><img src="images/5.png" alt="y's previous memory is now garbage, and a new memory location holds y's new value" /></p>

  <p><strong>Performance tip:</strong>
If you can, stay in smi range.
Small machine integers fit in a register and can be loaded and stored
directly in the field instead of being fetched from memory.
They also never require memory allocation.
<strong>Note:</strong> The smi range depends on the CPU architecture.</p>

  <h4 id="optimally-shifting-to-the-left">Optimally shifting to the left</h4>

  <p>Left shifts are used for both arithmetic and logical operations.
When shifting to the left,
you must be careful that the values remain in smi range.
The VM performs an optimization when it sees a left shift
masked with a constant smi value:</p>

  <pre><code>result = (int1 &lt;&lt; int2) &amp; CONSTANT;  // CONSTANT within smi range
</code></pre>

  <p>For example:</p>

  <pre><code>a = (b &lt;&lt; c) &amp; 0x3FFFFFFF;
</code></pre>

  <p>The VM knows that the result can be stored in a smi,
and it generates code that doesn’t check whether
a mint is needed to store the result.
The constant 0x3FFFFFFF is the maximum positive smi on 32-bit architectures.
0x3FFFFFFFFFFFFFFF is the equivalent constant on 64-bit architectures.
The constant does not have to be 0x3FFFFFFF;
it can be any constant that is a smi.</p>

  <p><strong>Performance tip:</strong>
Because the smi range is variable,
assume a 31-bit range unless you require more bits.</p>

  <p><strong>Pro tip:</strong>
Hexadecimal constants are signed in Dart,
so you must prefix the hexadecimal constant with a minus sign
if you want it to be negative.
On a 32-bit machine,
the largest negative number that is still a smi is -0x40000000;
the largest positive number that is still a smi is 0x3FFFFFFF.</p>

  <h4 id="lists-of-integers">Lists of integers</h4>

  <p>When a smi is loaded or stored into an object list (List)
the smi value, unaltered, is copied into the list.
This is the most efficient way to load and store integers
within the smi range.
In contrast, loading and storing a smi into a typed list (dart:typed_data)
requires the smi to be untagged and tagged, respectively.
These operations can add overhead when working with typed lists.</p>

  <p>Consider the following code,
assuming that all integer variables stay within the smi range:</p>

  <pre><code>for (int i = 0; i &lt; list.length; i++) {
  list[i] = list[i] + b;
}
</code></pre>

  <p>If <code>list</code> is an object list,
no smi tagging or untagging occurs.
Note that some integer operations—for example,
addition—can work on tagged smi values while others—for example,
multiplication—must first untag the smi values.
If <code>list</code> is a typed list,
the loaded value must be tagged and then,
before the result is stored,
it must be untagged.
Furthermore, the index (<code>i</code>)
into a typed list is untagged and then tagged.</p>

  <p><strong>Performance tip:</strong>
When working within the smi range,
consider using an object list instead of a typed list,
to improve speed.</p>

  <p>However, you might want to use a typed list instead of an object list
because typed lists have a smaller GC impact
and better CPU cache performance:</p>

  <ul>
    <li>
      <p>Because typed lists can never store an object reference,
the garbage collection load for typed lists is very low.
In contrast an object list must be scanned,
and each entry is checked for an object pointer.</p>
    </li>
    <li>
      <p>Typed lists can be much more dense.
For example, if you know you need only 8 bits of precision
you can use an Int8List,
using much less memory and making better use of your CPU’s cache.</p>
    </li>
  </ul>

  <p>In general and specifically because of the above caveats,
it is always a good idea to
<a href="http://takyam-git.github.io/www.dartlang.org/articles/benchmarking/">benchmark</a>
your algorithm using both object and typed lists.</p>

  <p><strong>Performance tip:</strong>
If possible, avoiding storing integers outside the smi range in typed lists.
When an integer is loaded from a typed list
that can hold integer values outside of the smi or mint range,
a check must be done and an object may be allocated.
Int32List and Uint32List can hold numbers
that are bigger than a smi on 32-bit architectures.
Int64List and Uint64List can hold numbers that are bigger than a mint,
resulting in a bigint on all platforms!</p>

  <h4 id="bigints">Bigints</h4>

  <p>The third integer representation, bigint,
holds an arbitrarily large signed integer.
The field a bigint is stored into holds the address of the bigint instance.
When loading a bigint,
the entire numeric value does not fit inside a CPU register,
and the CPU does not have instructions for operations on bigint values.
Thus, bigints are significantly more expensive than smis or mints.</p>

  <p><strong>Performance tip:</strong>
Avoid bigint whenever possible.
The VM doesn’t optimize operations on bigint instances.</p>

  <h3 id="doubles">Doubles</h3>

  <p>Computations involving double values are unboxed,
making them very efficient.</p>

  <h4 id="lists-of-doubles">Lists of doubles</h4>

  <p>When a double is stored into an object list,
it must be boxed,
which requires a memory allocation and a memory store.</p>

  <p>Two typed lists support double-precision values: Float32List and Float64List.
The trade-off between the two lists is
storage density versus the conversion cost.
Float32List is twice as dense as Float64List,
but values loaded from a Float32List must be converted
to a double-precision number.
Conversely, doubles must be converted to a single-precision number
on storage in a Float32List.</p>

  <p><strong>Performance tip:</strong>
Use Float32List or Float64List whenever you store lists of double values.
Unlike the case with smis,
using an object list with doubles is always slower.</p>

  <p><strong>Performance tip:</strong>
<a href="http://takyam-git.github.io/www.dartlang.org/articles/benchmarking/">Benchmark</a>
your application using both Float32List and Float64List
to determine which performs best.</p>

  <h3 id="boxing">Boxing</h3>

  <p><em>Boxing</em> is the operation of moving a scalar value from a register
and placing it inside a Dart object.
<em>Unboxing</em> is the opposite:
taking the scalar value stored inside a Dart object
and placing it inside a register to be operated on.</p>

  <p>Boxing is expensive and something that you want to avoid
in the middle of numeric computation.
The following operations can trigger a number to be boxed:</p>

  <ul>
    <li>
      <p>Passing a number to another function.
Functions accept only boxed objects,
so if you pass an unboxed number to a function,
the number will be boxed first.</p>
    </li>
    <li>
      <p>Returning a number from a function.
Functions can return only boxed objects,
so if you return an unboxed number from a function,
the number will be boxed first.</p>
    </li>
    <li>
      <p>Storing a non-smi number to a field.
Fields can hold only smi values or object pointers.</p>
    </li>
  </ul>

  <p>Boxing requires a memory allocation and a store.
Unboxing requires a load.</p>

  <p><img src="images/6.png" alt="Illustration of boxing and unboxing 3.14159" /></p>

  <h3 id="lists">Lists</h3>

  <p>Remember, two kinds of list can store numeric data—the
object list and the typed list.
This section tells you how list data is laid out in memory
and how loading and storing work.</p>

  <h4 id="object-lists-instances-of-list">Object lists (instances of List)</h4>

  <p>At runtime, an object list (a List) is an array of pointers.
Each entry in the array holds a pointer to the number stored in that entry.
The only exception is smi,
which fits in the memory used to store the pointer.
When type checking is not enforced,
object lists can hold objects of any type.
Object lists can contain the null object.</p>

  <p><img src="images/7.png" alt="Illustration of a list's memory, which contains a smi (4) and two points to doubles (1.0 and 2.0)" /></p>

  <p>Loading a number from an object list works like this:</p>

  <ol>
    <li>
      <p>The base address of the backing store for the list is calculated.
(For growable lists, this includes a dependent load.)</p>
    </li>
    <li>
      <p>The address of the number or the tagged smi is loaded from
the list backing store.</p>
    </li>
  </ol>

  <p><img src="images/8.png" alt="Illustration of loading a number from an object list" /></p>

  <p>Storing a number into an object list works like this:</p>

  <ol>
    <li>If the number is not a smi,
a new number instance is allocated.</li>
    <li>The base address of the backing store for the list is calculated.
(For growable lists,
this includes a dependent load.)</li>
    <li>The address of the number or the tagged smi value is stored in
the list backing store.</li>
  </ol>

  <p><img src="images/9.png" alt="Illustration of storing a number into an object list" /></p>

  <h4 id="typed-lists-1">Typed lists</h4>

  <p>At runtime, a typed list is an array of numeric values.
Each entry in the array always holds the value directly.
Typed lists can be much denser,
providing better memory and CPU cache usage.
Typed lists are also faster to process at garbage collection time
because they don’t have to be scanned for object pointers.</p>

  <p><img src="images/10.png" alt="Illustration of a typed list's memory, containing the numbers 4, 1.0, and 2.0 (and no pointers)" /></p>

  <p>Loading a double-precision number from a typed data list works like this:</p>

  <ol>
    <li>The base address of the backing store for the list is calculated.
(For transferrable lists,
this includes a dependent load.)</li>
    <li>The value is loaded from the list backing store.</li>
  </ol>

  <p><img src="images/11.png" alt="Illustration of loading a number from a typed list" /></p>

  <p>Storing a double-precision number into a typed data list works like this:</p>

  <ol>
    <li>The base address of the backing store for the list is calculated.
(For transferrable lists,
this includes a dependent load.)</li>
    <li>The double number is stored into the list backing store.</li>
  </ol>

  <p><img src="images/12.png" alt="Illustration of storing a number into a typed list" /></p>

  <p>Loading an integer number from a typed list can be more expensive than
the double case in the following two cases:</p>

  <ul>
    <li>
      <p>The number retrieved from the list is outside smi range
but inside mint range.
In this case a mint must allocated to store the number.
This case is possible with Int32List, Uint32List, Int64List, and Uint64List.
Optimized code can avoid the mint allocation
by loading directly into an unboxed mint.</p>
    </li>
    <li>
      <p>The number retrieved is outside mint range.
In this case a bigint must be allocated to store the number.
This case is possible with Int64List and Uint64List.</p>
    </li>
  </ul>

  <p>Note that loading or storing a smi into a typed list requires that
the value be tagged or untagged, respectively.</p>

  <p><strong>Performance tip:</strong>
Flatten multiple-dimension lists into a single list,
and compute the flattened index at runtime.
This way you avoid the expense of dealing with a list of lists.</p>

  <h2 id="considerations-when-dart-is-compiled-to-javascript">Considerations when Dart is compiled to JavaScript</h2>

  <p>JavaScript has only one number representation:
an IEEE-754 double-precision floating-point number.
This means that any number—integer or floating point—is
represented as a double.
JavaScript has typed data arrays,
and the mapping from native Dart typed lists
to JavaScript typed arrays is trivial.</p>

  <h3 id="integer-precision">Integer precision</h3>

  <p>Because all numbers are stored as doubles,
integers are restricted to a 53-bit precision.
Integer values in the range of -2<sup>53</sup> to 2<sup>53</sup> can be stored
without loss of accuracy.
Because JavaScript VMs play tricks
with the internal representation of numbers
(similar to those described above),
staying within smi range is still good practice.</p>

  <h3 id="typed-lists-2">Typed lists</h3>

  <p>JavaScript offers typed arrays
that are compatible with Dart’s typed lists.
The mapping is trivial—for example,
Float32List becomes a Float32Array.
The one exception today is that dart2js does not support 64-bit integers
and thus does not support Int64List or Uint64List.
Dart code compiled via dart2js results in a runtime exception
if either of those lists is used.</p>
</div>

    	  </div> <!-- End of content from toc.html -->
        </article>
	  </div>

	
	<ul class="pager hidden-print">
	  <li><a href="http://takyam-git.github.io/www.dartlang.org/articles/">More articles about Dart <i class="glyphicon glyphicon-chevron-up"></i></a></li>
	 </ul>
	 

	</div>
  </div>
</div>


  <footer class="footer container-full hidden-print">
    <div class="container">
      <div class="row">
        <div class="col-md-5">
          <h3>A new language, with tools and libraries, for SCALABLE web app engineering</h3>
          <p>Dart is an <a href="https://code.google.com/p/dart/">open-source project</a> with contributors from Google and elsewhere.</p>
          <p class="sm">Except as otherwise noted, the content of this page is licensed under the Creative Commons Attribution 3.0 License, and code samples are licensed under the BSD License.</p>
        </div>
        <div class="col-md-2 col-md-offset-1">
          <h4>Popular Topics</h4>
          <ul>
            <li><a href="http://takyam-git.github.io/www.dartlang.org/polymer/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">Polymer.dart</a></li>
            <li><a href="http://takyam-git.github.io/www.dartlang.org/performance/">Performance</a></li>
            <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/dart-up-and-running/ch02.html?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">Language tour</a> &amp;
            <a href="http://takyam-git.github.io/www.dartlang.org/docs/dart-up-and-running/ch03.html?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">library tour</a></li>
            <li><a href="http://takyam-git.github.io/www.dartlang.org/samples/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">Code samples</a></li>
            <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/tutorials/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">Tutorials</a> &amp;
                <a href="http://takyam-git.github.io/www.dartlang.org/codelabs/darrrt/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">code lab</a></li>
          </ul>
        </div>
        <div class="col-md-2">
          <h4>Resources</h4>
          <ul>
            <li><a href="http://pub.dartlang.org/">Pub packages</a></li>
            <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/synonyms/">Synonyms with other languages</a></li>
            <li><a href="http://code.google.com/p/dart/issues/list">Dart bugs and feature requests</a></li>
            <li><a href="https://github.com/dart-lang/dartlang.org">www.dartlang.org repo</a></li>
          </ul>
        </div>
        <div class="col-md-2">
          <h4>Community</h4>
          <ul>
            <li><a href="http://takyam-git.github.io/www.dartlang.org/support/">Mailing lists</a></li>
            <li><a href="https://plus.google.com/communities/114566943291919232850">G+ community</a></li>
            <li><a href="https://plus.google.com/+dartlang/posts">G+ announcement group</a></li>
            <li><a href="http://stackoverflow.com/questions/tagged/dart">Stack Overflow</a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer> <!-- End footer -->



<script type='text/javascript' src='http://takyam-git.github.io/www.dartlang.org/bundles/514ef0286af67b679d4820fd3c90e3ce.js'></script>




<link rel='stylesheet' type='text/css' href='http://takyam-git.github.io/www.dartlang.org/bundles/2afe6beaa026f8648e912263a89be985.css' />






</body>
</html>

