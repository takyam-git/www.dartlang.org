<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/Product">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>Pub Versioning Philosophy | Dart: Structured web apps</title>
  <meta property="twitter:account_id" content="376585411" />
  <meta itemprop="name" content="Pub Versioning Philosophy | Dart: Structured web apps">
  
  <meta itemprop="image" content="https://www.dartlang.org/imgs/dart-logo-wordmark-1200w.png">
  
  <meta itemprop="description" content="Dart is a new platform for building structured web apps for modern browsers. It includes a language, a VM, libraries, tools, and a compiler to JavaScript. Try Dart today!">



<!-- making pagespeed insights happy -->
<style>
@font-face {
  font-family: 'Montserrat';
  font-style: normal;
  font-weight: 400;
  src: url(https://themes.googleusercontent.com/static/fonts/montserrat/v4/zhcz-_WihjSQC0oHJ9TCYL3hpw3pgy2gAi-Ip7WPMi0.woff) format('woff');
}
@font-face {
  font-family: 'Montserrat';
  font-style: normal;
  font-weight: 700;
  src: url(https://themes.googleusercontent.com/static/fonts/montserrat/v4/IQHow_FEYlDC4Gzy_m8fcnbFhgvWbfSbdVg11QabG8w.woff) format('woff');
}
@font-face {
  font-family: 'Roboto';
  font-style: normal;
  font-weight: 300;
  src: url(https://themes.googleusercontent.com/static/fonts/roboto/v10/Hgo13k-tfSpn0qi1SFdUfbO3LdcAZYWl9Si6vvxL-qU.woff) format('woff');
}
@font-face {
  font-family: 'Roboto';
  font-style: normal;
  font-weight: 400;
  src: url(https://themes.googleusercontent.com/static/fonts/roboto/v10/CrYjSnGjrRCn0pd9VQsnFOvvDin1pK8aKteLpeZ5c0A.woff) format('woff');
}
</style>

<link rel='stylesheet' type='text/css' href='http://takyam-git.github.io/www.dartlang.org/bundles/96e4b278be2e9b94cffcad9b0b04384c.css' />


  
  

  <link rel="alternate" type="application/atom+xml" href="http://news.dartlang.org/feeds/posts/default" title="Atom feed">
  <link href="https://plus.google.com/109866369054280216564" rel="publisher">

  <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
    <script src="js/html5shiv.js"></script>
    <script src="js/respond.min.js"></script>
  <![endif]-->

  <script>

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-49880327-3', 'dartlang.org');
ga('create', 'UA-26406144-4',
    {'cookieDomain': 'dartlang.org',
     'siteSpeedSampleRate': 50,
     'name': 'dartlangTracker'});

ga('send', 'pageview');
ga('dartlangTracker.send', 'pageview');

</script>


  <script async="" defer="" src="http://takyam-git.github.io/www.dartlang.org/survey.g.doubleclick.net/async_survey?site=apno2k33xucna4srya26u4i2ri"></script>

</head>
<body onload="prettyPrint()" data-spy="scroll" data-target=".bs-sidebar">

    <div class="navbar navbar-fixed-top navbar-inverse" role="navigation">
      <div class="dart-developer-summit-reg" style="text-align:center;background-color: hsl(172,67%,80%);">
        <a href="http://takyam-git.github.io/www.dartlang.org/events/2015/summit/">Watch sessions from the first Dart Developer Summit</a>
      </div>
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://takyam-git.github.io/www.dartlang.org/"><i class="sprite-icon-dart-logo"></i></a>
        </div>

        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
           <li class="dropdown">
              <a href="#" class="dropdown=toggle" data-toggle="dropdown">
                Get Started <span class="caret"></span>
              </a>
              <ul class="dropdown-menu">

                <i class="sprite-icon-dd-tip"></i>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/codelabs/darrrt/">Learn Dart in Minutes</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/downloads/">Download Dart</a></li>
              </ul>
            </li>

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    Fundamentals <span class="caret"></span>
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/dart-up-and-running/ch02.html">Language Tour</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/dart-up-and-running/ch03.html">Library Tour</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/">Programmer's Guide</a></li>

                <li class="divider"></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/tools/">Dart Tools</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/tools/pub/">Pub Package and Asset Manager</a></li>

                <li class="divider"></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/tutorials/get-started/">Tutorial: Get Started</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/tutorials/shared-pkgs/">Tutorial: Packages</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/tutorials/futures/">Tutorial: Async</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    Browser<span class="caret"></span>
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/polymer/">Polymer</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/codelabs/polymer/">Polymer Code Lab</a></li>
                <li class="divider"></li>
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/tutorials/connect-dart-html/">Tutorial: HTML</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/tutorials/polymer-intro/">Tutorial: Polymer</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/tutorials/fetchdata/">Tutorial: Forms & Data</a></li>
                <li class="divider"></li>
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/tools/editor/mobile.html">Mobile</a></li>

                <li class="divider"></li>
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/googleapis/">Google APIs Client Libraries</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    Server <span class="caret"></span>
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/tutorials/cmdline/">Tutorial: Basic Command-Line Apps</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/tutorials/httpserver/">Tutorial: HTTP Servers and Clients</a></li>

                <li class="divider"></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/server/google-cloud-platform/">Deploying Your Server Application</a></li>
                <i class="sprite-icon-dd-tip"></i>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/googleapis/">Using Google APIs from Your Server</a></li>

                <li class="divider"></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/serverguide.html">Additional Resources</a></li>
              </ul>
            </li>

            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    More <span class="caret"></span>
              </a>
              <ul class="dropdown-menu">
                <i class="sprite-icon-dd-tip"></i>

                <li><a href="http://takyam-git.github.io/www.dartlang.org/samples/">Code Samples</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/synonyms/">Synonyms with Other Languages</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/dart-by-example/">Dart by Example</a></li>

                <li class="divider"></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/articles/">Articles</a></li>
                <li><a href="http://api.dartlang.org">API Reference</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/spec/">Language Specification</a></li>

                <li class="divider"></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/community/who-uses-dart.html">Who Uses Dart</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/support/faq.html">FAQ</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/logos/">Logos and Colors</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/books/">Books</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/performance/">Performance</a></li>

                <li class="divider"></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/slides/">Presentations</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/dart-tips/">Dart Tips Videos</a></li>
                <li><a href="http://takyam-git.github.io/www.dartlang.org/support/">Support</a></li>
              </ul>
            </li>
          </ul>

          <ul class="nav navbar-nav navbar-right">
            <li>
              <form class="navbar-search" action="/search.html" id="cse-search-box">
                <input type="hidden" name="cx" value="011220921317074318178:i4mscbaxtru">
                <input type="hidden" name="ie" value="UTF-8">
                <input type="hidden" name="hl" value="en">
                <input type="search" name="q" class="search-query placeholder-position-fix form-control" id="q" autocomplete="off" placeholder="Search">
              </form>
            </li>
            <li><a href="https://twitter.com/dart_lang" class="btn"><i class="sprite-icon-social-twitter"></i></a></li>
            <li><a href="https://plus.google.com/+dartlang/posts" class="btn"><i class="sprite-icon-social-gplus"></i></a></li>
          </ul>
        </div><!-- /.nav-collapse -->

      </div><!-- /.container -->
    </div><!-- /.navbar -->


<div class="container-page">
  <div class="container">
    <div class="container col-md-10 col-md-offset-1 sub-page">
      <div>
      <div class="col-md-4">
  <div class="bs-sidebar" data-spy="affix" data-offset-bottom="350" role="complementary">

<ol class="toc nav bs-sidenav" id="markdown-toc">
  <li><a href="#a-name-and-a-number">A name and a number</a></li>
  <li><a href="#shared-dependencies-and-unshared-libraries">Shared dependencies and unshared libraries</a></li>
  <li><a href="#version-lock">Version lock</a></li>
  <li><a href="#version-constraints">Version constraints</a></li>
  <li><a href="#semantic-versions">Semantic versions</a></li>
  <li><a href="#constraint-solving">Constraint solving</a></li>
  <li><a href="#constraint-context">Constraint context</a></li>
  <li><a href="#constraint-solving-for-exported-dependencies">Constraint solving for exported dependencies</a></li>
  <li><a href="#lockfiles">Lockfiles</a></li>
  <li><a href="#when-things-go-wrong">When things go wrong</a>    <ol>
      <li><a href="#you-can-have-disjoint-constraints">You can have disjoint constraints</a></li>
      <li><a href="#you-can-have-ranges-that-dont-contain-a-released-version">You can have ranges that don’t contain a released version</a></li>
      <li><a href="#you-can-have-an-unstable-graph">You can have an unstable graph</a></li>
    </ol>
  </li>
  <li><a href="#summary">Summary</a></li>
</ol>

  </div>
</div>
<div class="col-md-8">
  <p><!-- Start of content -->
</p>

  <div>
    <ol class="breadcrumb">

  <li><a href="http://takyam-git.github.io/www.dartlang.org/tools/">
  Dart Tools</a></li>

  <li><a href="http://takyam-git.github.io/www.dartlang.org/tools/pub/">
  Pub</a></li>


  <li class="active">Pub Versioning Philosophy</li>
</ol>
  </div>

  <h1 id="pub-versioning-philosophy">Pub Versioning Philosophy</h1>

  <p>One of <a href="http://takyam-git.github.io/www.dartlang.org/tools/pub/">pub</a>’s main jobs is helping you work with versioning.
This document explains a bit about the history of versioning and pub’s
approach to it.
Consider this to be advanced information. If you want a better picture of <em>why</em>
pub was designed the way it was, read on. If you just want to <em>use</em> pub, the
<a href="index.html">other docs</a> will serve you better.</p>

  <p>Modern software development, especially web development, leans heavily on
reusing lots and lots of existing code. That includes code <em>you</em> wrote in the
past, but also code from third-parties, everything from big frameworks to small
utility libraries. It’s not uncommon for an application to depend on
dozens of different packages and libraries.</p>

  <p>It’s hard to understate how powerful this is. When you see stories of small web
startups building a site in a few weeks that gets millions of users, the
only reason they can achieve this is because the open source community has
laid a feast of software at their feet.</p>

  <p>But this doesn’t come for free: There’s a challenge to code
reuse, especially reusing code you don’t maintain. When your app uses code
being developed by other people, what happens when they change it? They
don’t want to break your app, and you certainly don’t either.</p>

  <h2 id="a-name-and-a-number">A name and a number</h2>

  <p>We solve this by <em>versioning</em>. When you depend on some piece of outside code,
you don’t just say “My app uses <code>widgets</code>.” You say, “My app uses
<code>widgets 2.0.5</code>.” That combination of name and version number uniquely
identifies an <em>immutable</em> chunk of code. The people updating <code>widgets</code> can
make all of the changes they want, but they promise to not touch any already
released versions. They can put out <code>2.0.6</code> or <code>3.0.0</code> and it won’t affect you
one whit because the version you use is unchanged.</p>

  <p>When you <em>do</em> want to get those changes, you can always point your app to a
newer version of <code>widgets</code> and you don’t have to coordinate with those
developers to do it. So, problem solved, right?</p>

  <h2 id="shared-dependencies-and-unshared-libraries">Shared dependencies and unshared libraries</h2>

  <p>Well, no. Depending on specific versions works fine when your dependency
<em>graph</em> is really just a dependency <em>tree</em>. If your app depends on a bunch of
packages, and those things in turn have their own dependencies and so on, that
all works fine as long as none of those dependencies <em>overlap</em>.</p>

  <p>But consider the following example:</p>

  <p><img src="images/PubConstraintsDiagram.png" alt="diagram showing my_app has dependencies on widgets and templates which both have a dependency on collection" /></p>

  <p>So your app uses <code>widgets</code> and <code>templates</code>, and <em>both</em> of those use
<code>collection</code>. This is called a <strong>shared dependency</strong>. Now what happens when
<code>widgets</code> wants to use <code>collection 2.3.5</code> and <code>templates</code> wants
<code>collection 2.3.7</code>? What if they don’t agree on a version?</p>

  <p>One option is to just let the app use both
versions of <code>collection</code>. It will have two copies of the library at different
versions and <code>widgets</code> and <code>templates</code> will each get the one they want.</p>

  <p>This is what <a href="https://npmjs.org/">npm</a> does for node.js. Would it work for Dart? Consider this
scenario:</p>

  <ol>
    <li><code>collection</code> defines some <code>Dictionary</code> class.</li>
    <li><code>widgets</code> gets an instance of it from its copy of <code>collection</code> (<code>2.3.5</code>).
It then passes it up to <code>my_app</code>.</li>
    <li><code>my_app</code> sends the dictionary over to <code>templates</code>.</li>
    <li>That in turn sends it down to <em>its</em> version of <code>collection</code> (<code>2.3.7</code>).</li>
    <li>The method that takes it has a <code>Dictionary</code> type annotation for that object.</li>
  </ol>

  <p>As far as Dart is concerned, <code>collection 2.3.5</code> and <code>collection 2.3.7</code> are
entirely unrelated libraries. If you take an instance of class <code>Dictionary</code>
from one and pass it to a method in the other, that’s a completely different
<code>Dictionary</code> type. That means it will fail to match a <code>Dictionary</code> type
annotation in the receiving library. Oops.</p>

  <p>Because of this (and because of the headaches of trying to debug an app that
has multiple versions of things with the same name), we’ve decided npm’s model
isn’t a good fit.</p>

  <h2 id="version-lock">Version lock</h2>

  <p>Instead, when you depend on a package, your app will only use a single copy of
that package. When you have a shared dependency, everything that depends on it
has to agree on which version to use. If they don’t, you get an error.</p>

  <p>That doesn’t actually solve your problem though. When you <em>do</em> get that error,
you need to be able to resolve it. So let’s say you’ve gotten yourself into
that situation in the previous example. You want to use <code>widgets</code> and
<code>templates</code>, but they are using different versions of <code>collection</code>. What do
you do?</p>

  <p>The answer is to try to upgrade one of those. <code>templates</code> wants
<code>collection 2.3.7</code>. Is there a later version of <code>widgets</code> that you can upgrade
to that works with that version?</p>

  <p>In many cases, the answer will be “no”. Look at it from the perspective of the
people developing <code>widgets</code>. They want to put out a new version with new changes
to <em>their</em> code, and they want as many people to be able to upgrade to it it as
possible. If they stick to their <em>current</em> version of <code>collection</code> then anyone
who is using the current version <code>widgets</code> will be able to drop in this new one
too.</p>

  <p>If they were to upgrade <em>their</em> dependency on <code>collection</code> then everyone who
upgrades <code>widgets</code> would have to as well, <em>whether they want to or not.</em> That’s
painful, so you end up with a disincentive to upgrade dependencies. That’s
called <strong>version lock</strong>: everyone wants to move their dependencies forward, but
no one can take the first step because it forces everyone else to as well.</p>

  <h2 id="version-constraints">Version constraints</h2>

  <p>To solve version lock, we loosen the constraints that packages place on their
dependencies. If <code>widgets</code> and <code>templates</code> can both indicate a <em>range</em> of
versions for <code>collection</code> that they will work with, then that gives us enough
wiggle room to move our dependencies forward to newer versions. As long as there
is overlap in their ranges, we can still find a single version that makes them
both happy.</p>

  <p>This is the model that <a href="http://gembundler.com/">bundler</a> follows, and is pub’s
model too. When you add a dependency in your pubspec, you can specify a <em>range</em>
of versions that you can accept. If the pubspec for <code>widgets</code> looked like this:</p>

  <pre class="prettyprint lang-yaml">
dependencies:
  collection: &#39;&gt;=2.3.5 &lt;2.4.0&#39;
</pre>

  <p>Then we could pick version <code>2.3.7</code> for <code>collection</code> and then both <code>widgets</code>
and <code>templates</code> have their constraints satisfied by a single concrete version.</p>

  <h2 id="semantic-versions">Semantic versions</h2>

  <p>When you add a dependency to your package, you’ll sometimes want to specify a
range of versions to allow. How do you know what range to pick? You need to
forward compatible, so ideally the range encompasses future versions that
haven’t been released yet. But how do you know your package is going to work
with some new version that doesn’t even exist yet?</p>

  <p>To solve that, you need to agree on what a version number <em>means</em>. Imagine that
the developers of a package you depend on say, “If we make any backwards
incompatible change, then we promise to increment the major version number.”
If you trust them, then if you know your package works with <code>2.5.7</code> of theirs,
you can rely on it working all the way up to <code>3.0.0</code>. So you can set your range
like:</p>

  <pre class="prettyprint lang-yaml">
dependencies:
  collection: &#39;&gt;=2.3.5 &lt;3.0.0&#39;
</pre>

  <p>To make this work, then, we need to come up with that set of promises.
Fortunately, other smart people have done the work of figuring this all out and
named it <a href="http://semver.org/spec/v2.0.0-rc.1.html"><em>semantic versioning</em></a>.</p>

  <p>That describes the format of a version number, and the exact API behavioral
differences when you increment to a later version number. Pub requires versions
to be formatted that way, and to play well with the pub community, your package
should follow the semantics it specifies. You should assume that the packages
you depend on also follow it. (And if you find out they don’t, let their
authors know!)</p>

  <p>Although semantic versioning doesn’t promise any compatibility between versions
prior to <code>1.0.0</code>, the Dart community convention is to treat those versions
semantically as well. The interpretation of each number is just shifted down one
slot: going from <code>0.1.2</code> to <code>0.2.0</code> indicates a breaking change, going to
<code>0.1.3</code> indicates a new feature, and going to <code>0.1.2+1</code> indicates a change that
doesn’t affect the public API.</p>

  <p>We’ve got almost all of the pieces we need to deal with versioning and API
evolution now. Let’s see how they play together and what pub does.</p>

  <h2 id="constraint-solving">Constraint solving</h2>

  <p>When you define your package, you list its
<a href="glossary.html#immediate-dependency"><strong>immediate dependencies</strong></a>—the
packages it itself uses. For each one, you specify the range of versions it
allows. Each of those dependent packages may in turn have their own
dependencies (called
<a href="glossary.html#transitive-dependency"><strong>transitive dependencies</strong></a>. Pub will
traverse these and  build up the entire deep dependency graph for your app.</p>

  <p>For each package in the graph, pub looks at everything that depends on it. It
gathers together all of their version constraints and tries to simultaneously
solve them. (Basically, it intersects their ranges.) Then it looks at the
actual versions that have been released for that package and selects the best
(most recent) one that meets all of those constraints.</p>

  <p>For example, let’s say our dependency graph contains <code>collection</code>, and three
packages depend on it. Their version constraints are:</p>

  <pre><code>&gt;=1.7.0
&gt;=1.4.0 &lt;2.0.0
&lt;1.9.0
</code></pre>

  <p>The developers of <code>collection</code> have released these versions of it:</p>

  <pre><code>1.7.0
1.7.1
1.8.0
1.8.1
1.8.2
1.9.0
</code></pre>

  <p>The highest version number that fits in all of those ranges is <code>1.8.2</code>, so pub
picks that. That means your app <em>and every package your app uses</em> will all use
<code>collection 1.8.2</code>.</p>

  <h2 id="constraint-context">Constraint context</h2>

  <p>The fact that selecting a package version takes into account <em>every</em> package
that depends on it has an important consequence: <em>the specific version that
will be selected for a package is a global property of the app using that
package.</em></p>

  <p>The following example shows what this means. Let’s say we have
two apps. Here are their pubspecs:</p>

  <pre class="prettyprint lang-yaml">
name: my_app
dependencies:
  widgets:
</pre>

  <pre class="prettyprint lang-yaml">
name: other_app
dependencies:
  widgets:
  collection: &#39;&lt;1.5.0&#39;
</pre>

  <p>They both depend on <code>widgets</code>, whose pubspec is:</p>

  <pre class="prettyprint lang-yaml">
name: widgets
dependencies:
  collection: &#39;&gt;=1.0.0 &lt;2.0.0&#39;
</pre>

  <p>The <code>other_app</code> package uses depends directly on <code>collection</code> itself. The
interesting part is that it happens to have a different version constraint on
it than <code>widgets</code> does.</p>

  <p>What this means is that you can’t just look at the <code>widgets</code> package in
isolation to figure out what version of <code>collection</code> it will use. It depends
on the context. In <code>my_app</code>, <code>widgets</code> will be using <code>collection 1.9.9</code>. But
in <code>other_app</code>, <code>widgets</code> will get saddled with <code>collection 1.4.9</code> because of
the <em>other</em> constraint that <code>otherapp</code> places on it.</p>

  <p>This is why each app gets its own “packages” directory: The concrete version
selected for each package depends on the entire dependency graph of the
containing app.</p>

  <h2 id="constraint-solving-for-exported-dependencies">Constraint solving for exported dependencies</h2>

  <p>Package authors must define package contraints with care.
Consider the following scenario:</p>

  <p><img src="images/PubExportedConstraints.png" alt="diagram showing bookshelf package has a dependency on widges which has a dependency on collection" /></p>

  <p>The <code>bookshelf</code> package depends on <code>widgets</code>.
The <code>widgets</code> package, currently at 1.2.0,
<a href="http://takyam-git.github.io/www.dartlang.org/docs/dart-up-and-running/ch02.html#re-exporting-libraries">exports</a>
<code>collection</code> via <code>export "package:collection/collection.dart"</code>, and is
at 2.4.0. The pubspec files are as follows:</p>

  <pre class="prettyprint lang-yaml">
name: bookshelf
dependencies:
  widgets:  &#39;&gt;=1.2.0 &lt;2.0.0&#39;
</pre>

  <pre class="prettyprint lang-yaml">
name: widgets
dependencies:
  collection:  &#39;&gt;=2.4.0 &lt;3.0.0&#39;
</pre>

  <p>The <code>collection</code> package is then updated to 2.5.0.
The 2.5.0 verion of <code>collection</code> includes a new method called <code>sortBackwards</code>.
<code>bookshelf</code> may call <code>sortBackwards</code>, 
because it’s part of the API exposed by <code>widgets</code>,
despite <code>bookshelf</code> having only a transitive dependency on <code>collection</code>.</p>

  <p>Because <code>widgets</code> has an API that is not reflected in its version number,
the app that uses the <code>bookshelf</code> package and calls <code>sortBackwards</code> may crash.</p>

  <p>Exporting an API causes that API to be treated as if it is
defined in the package itself, but it can’t increase the version number when
the API adds features. This means that <code>bookshelf</code> has no way of declaring
that it needs a version of <code>widgets</code> that supports <code>sortBackwards</code>.</p>

  <p>For this reason, when dealing with exported packages,
it’s recommended that the package’s author keeps a tighter
limit on the upper and lower bounds of a dependency.
In this case, the range for the <code>widgets</code> package should be narrowed:</p>

  <pre class="prettyprint lang-yaml">
name: bookshelf
dependencies:
  widgets:  &#39;&gt;=1.2.0 &lt;1.3.0&#39;
</pre>

  <pre class="prettyprint lang-yaml">
name: widgets
dependencies:
  collection:  &#39;&gt;=2.4.0 &lt;2.5.0&#39;
</pre>

  <p>This translates to a lower bound of 1.2.0 for <code>widgets</code> and 2.4.0
for <code>collection</code>.
When the 2.5.0 version of <code>collection</code> is released,
then <code>widgets</code> is also updated to 1.3.0 and the corresponding constraints
are also updated.</p>

  <p>Using this convention ensures that users have the correct version of
both packages, even if one is not a direct dependency.</p>

  <h2 id="lockfiles">Lockfiles</h2>

  <p>So once pub has solved your app’s version constraints, then what? The end
result is a complete list of every package that your app depends on either
directly or indirectly and the best version of that package that will work with
your app’s constraints.</p>

  <p>Pub takes that and writes it out to a <strong>lockfile</strong> in your app’s directory
called <code>pubspec.lock</code>. When pub builds the “packages” directory your app, it
uses the lockfile to know what versions of each package to pull in. (And if
you’re curious to see what versions it selected, you can read the lockfile to
find out.)</p>

  <p>The next important thing pub does is it <em>stops touching the lockfile</em>. Once
you’ve got a lockfile for your app, pub won’t touch it until you tell it to.
This is important. It means you won’t spontanteously start using new versions
of random packages in your app without intending to. Once your app is locked,
it stays locked until you manually tell it to update the lockfile.</p>

  <p>If your package is for an app, you <em>check your lockfile into your source
control system!</em> That way, everyone on your team will be using
the exact same versions of every dependency when they build your app. You’ll
also use this when you deploy your app so you can ensure that your production
servers are using the exact same packages that you’re developing with.</p>

  <h2 id="when-things-go-wrong">When things go wrong</h2>

  <p>Of course, all of this presumes that your dependency graph is perfect and
flawless. Even with version ranges and pub’s constraint solving and
semantic versioning, you can never be entirely spared from the
dangers of versionitis.</p>

  <p>You might run into one of the following problems:</p>

  <h3 id="you-can-have-disjoint-constraints">You can have disjoint constraints</h3>

  <p>Lets say your app uses <code>widgets</code> and
<code>templates</code> and both use <code>collection</code>. But <code>widgets</code> asks for a version
of it between <code>1.0.0</code> and <code>2.0.0</code> and <code>templates</code> wants something
between <code>3.0.0</code> and <code>4.0.0</code>. Those ranges don’t even overlap. There’s no
possible version that would work.</p>

  <h3 id="you-can-have-ranges-that-dont-contain-a-released-version">You can have ranges that don’t contain a released version</h3>

  <p>Let’s say after
putting all of the constraints on a shared dependency together, you’re
left with the narrow range of <code>&gt;=1.2.4 &lt;1.2.6</code>. It’s not an empty range.
If there was a version <code>1.2.4</code> of the dependency, you’d be golden. But maybe
they never released that and instead when straight from <code>1.2.3</code> to <code>1.3.0</code>.
You’ve got a range but nothing exists inside it.</p>

  <h3 id="you-can-have-an-unstable-graph">You can have an unstable graph</h3>

  <p>This is, by far, the most challenging part of
pub’s version solving process. The process was described as “build up the
dependency graph and then solve all of the constraints and pick versions”.
But it doesn’t actually work that way. How could you build up the <em>whole</em>
dependency graph before you’ve picked <em>any</em> versions? <em>The pubspecs
themselves are version-specific</em>. Different versions of the same package
may have different sets of dependencies.</p>

  <p>As you’re selecting versions of packages, they are changing the shape of
the dependency graph itself. As the graph changes, that may change
constraints, which can cause you to select different versions, and then you
go right back around in a circle.</p>

  <p>Sometimes this process never settles down into a stable solution. Gaze into
the abyss:</p>

  <pre class="prettyprint lang-yaml">
name: my_app
version: 0.0.0
dependencies:
  yin: &#39;&gt;=1.0.0&#39;
</pre>

  <pre class="prettyprint lang-yaml">
name: yin
version: 1.0.0
dependencies:
</pre>

  <pre class="prettyprint lang-yaml">
name: yin
version: 2.0.0
dependencies:
  yang: &#39;1.0.0&#39;
</pre>

  <pre class="prettyprint lang-yaml">
name: yang
version: 1.0.0
dependencies:
  yin: &#39;1.0.0&#39;
</pre>

  <p>In all of these cases, there is no set of concrete versions that will work for
your app, and when this happens pub will report an error and tell you what’s
going on. It definitely will not try to leave you in some weird state where you
think things can work but won’t.</p>

  <h2 id="summary">Summary</h2>

  <p>That was a lot of information, but here are the key points:</p>

  <ul>
    <li>Code reuse is great, but in order to let developers move quickly, packages
need to be able to evolve independently.</li>
    <li>Versioning is how you enable that. But depending on single concrete versions
is too precise and with shared dependencies leads to version lock.</li>
    <li>To cope with that, you depend on <em>ranges</em> of versions. Pub will then walk
your dependency graph and pick the best versions for you. If it can’t, it
tells you.</li>
    <li>Once your app has a solid set of versions for its dependencies, that gets
pinned down in a <em>lockfile</em>. That ensures that every machine your app is
on is using the same versions of all of its dependencies.</li>
  </ul>
</div>

      </div>
    </div>
  </div>
</div>


  <footer class="footer container-full hidden-print">
    <div class="container">
      <div class="row">
        <div class="col-md-5">
          <h3>A new language, with tools and libraries, for SCALABLE web app engineering</h3>
          <p>Dart is an <a href="https://code.google.com/p/dart/">open-source project</a> with contributors from Google and elsewhere.</p>
          <p class="sm">Except as otherwise noted, the content of this page is licensed under the Creative Commons Attribution 3.0 License, and code samples are licensed under the BSD License.</p>
        </div>
        <div class="col-md-2 col-md-offset-1">
          <h4>Popular Topics</h4>
          <ul>
            <li><a href="http://takyam-git.github.io/www.dartlang.org/polymer/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">Polymer.dart</a></li>
            <li><a href="http://takyam-git.github.io/www.dartlang.org/performance/">Performance</a></li>
            <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/dart-up-and-running/ch02.html?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">Language tour</a> &amp;
            <a href="http://takyam-git.github.io/www.dartlang.org/docs/dart-up-and-running/ch03.html?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">library tour</a></li>
            <li><a href="http://takyam-git.github.io/www.dartlang.org/samples/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">Code samples</a></li>
            <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/tutorials/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">Tutorials</a> &amp;
                <a href="http://takyam-git.github.io/www.dartlang.org/codelabs/darrrt/?utm_source=site&amp;utm_medium=footer&amp;utm_campaign=homepage">code lab</a></li>
          </ul>
        </div>
        <div class="col-md-2">
          <h4>Resources</h4>
          <ul>
            <li><a href="http://pub.dartlang.org/">Pub packages</a></li>
            <li><a href="http://takyam-git.github.io/www.dartlang.org/docs/synonyms/">Synonyms with other languages</a></li>
            <li><a href="http://code.google.com/p/dart/issues/list">Dart bugs and feature requests</a></li>
            <li><a href="https://github.com/dart-lang/dartlang.org">www.dartlang.org repo</a></li>
          </ul>
        </div>
        <div class="col-md-2">
          <h4>Community</h4>
          <ul>
            <li><a href="http://takyam-git.github.io/www.dartlang.org/support/">Mailing lists</a></li>
            <li><a href="https://plus.google.com/communities/114566943291919232850">G+ community</a></li>
            <li><a href="https://plus.google.com/+dartlang/posts">G+ announcement group</a></li>
            <li><a href="http://stackoverflow.com/questions/tagged/dart">Stack Overflow</a></li>
          </ul>
        </div>
      </div>
    </div>
  </footer> <!-- End footer -->



<script type='text/javascript' src='http://takyam-git.github.io/www.dartlang.org/bundles/514ef0286af67b679d4820fd3c90e3ce.js'></script>




<link rel='stylesheet' type='text/css' href='http://takyam-git.github.io/www.dartlang.org/bundles/2afe6beaa026f8648e912263a89be985.css' />






</body>
</html>

